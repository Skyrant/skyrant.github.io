rh._.exports({"0":[["Lösch-Job Beispiel"]],"1":[["Lösch-Job"]],"2":[["\n"],["\n"],["\n","Im Folgenden wird beispielhaft beschrieben, wie ein \n Lösch-Job für bestimmte Meldeklassen mit einer kürzeren Haltedauer als \n im Standard-Job eingerichtet werden kann. Basierend darauf kann geschultes \n Personal weitere projekt-spezifische Skripte zum Löschen erstellen. Diese \n sollten immer in folgendem Ordner abgelegt werden:","\n","\"..\\sapient-engine\\src\\dist\\scripts\\jobs\\table_del\"","\n",":","\n","Gibt es für eine Tabelle einen Standard-Löschjob, \n so können Ausnahmen nur für kürzere Haltedauern als dort definiert erstellt \n werden. Der Standard-Job sollte also immer die größte benötigte Haltedauer \n berücksichtigen.","\n","Damit der Javascript-Job korrekt ausgeführt wird, muss \n ein neuer Eintrag in die Tabelle SYS_TABLE_DEL eingefügt werden. Dabei \n muss der korrekte Pfad zum Skript in der Spalte \"Lösch-Funktion\" \n eingetragen werden. Im Beispiel unten liegt die Datei unter <code>scripts/jobs</code>. \n In der Spalte \"Parameter\" werden dem Job die Meldeklassen 99 \n und 98 mit einer Haltedauer von 168 Stunden übergeben.","\n",":","\n","Projektspezifische Skripte können nicht auf \n Daten in den anderen Spalten der Tabelle SYS_TABLE_DEL zugreifen. Das \n heißt, Angaben zu Intervall, Haltedauer etc. müssen im Skript definiert \n werden, sie können nicht aus den entsprechenden Spalten gelesen werden.","\n"],["\n","Mit folgendem Statement kann der Job in die Datenbank \n eingefügt werden. Natürlich ist auch die Parametrierung über den LC2 möglich.","\n","<pre>","\n","insert into SYS_TABLE_DEL (TABLE_NAME, COLUMN_NAME, \n PRIORITY, SE_JOB_SYMBOL, INTERVAL_MINS, HOLD_HOURS, ","\n","    DEL_JOB_FUNCTION_PATH, DEL_JOB_PARAMS, \n OPTIONS, DEL_PORTION_PERC, ","\n","    DESC_INTERNAL)","\n","select td.TABLE_NAME, td.COLUMN_NAME, td.PRIORITY - \n 1, td.SE_JOB_SYMBOL, td.INTERVAL_MINS, 0, ","\n","    'jobs/table_del/table_del_AL_ARCHIVE_al_class/execute', \n '{\"AL_CLASS\": [99,98], \"HOLD_HOURS\": 168}', '2', 0,","\n","    'Project-specific deletion \n of table AL_ARCHIVE with respect of column AL_CLASS'","\n","  from SYS_TABLE_DEL td","\n"," where td.TABLE_NAME = 'AL_ARCHIVE'","\n","   and td.PRIORITY = 50;","\n","</pre>","\n"],["\n","Hier finden Sie ein Beispiel für die JavaScript-Datei. \n Diese kann bei Bedarf auch kopiert und entsprechend angepasst werden.","\n","function"," ","/*int*/ \n execute","(","/*SapientCallContext*/"," ","ctx",","," \n ","/*JSON map*/"," ","params",")"," \n ","{","\n","   "," ","logger",".","info","(","\"[TableDel_AL_ARCHIVE] \n started to execute\"",");","\n","   "," logger",".","debug","(","'[TableDel_AL_ARCHIVE] params: \n '"," ","+"," ","JSON",".","stringify","(","params","));","\n","   ","\n","   "," ","var"," ","con"," ","="," ","null",";","\n","   "," ","var"," ","qry"," ","="," ","null",";","\n","   "," ","var"," ","affectedRows"," ","="," ","0",";","\n","   "," ","var"," ","tableName"," ","="," ","\"AL_ARCHIVE\"",";","\n","   ","\n","   "," ","try"," ","{","\n","       "," ","// Get writable connection \n to Sapient DB","\n","       "," con"," \n ","="," ","new"," ","DbCon","(","ctx",","," ","DbCon",".","LEGATODB",","," ","true",");","\n","       "," ","var"," ","dbType"," ","="," ","con",".","dbtype",";","\n","       "," logger",".","debug","(","'[TableDel_AL_ARCHIVE] dbType: \n '"," ","+"," ","dbType",");","\n","       ","\n","       "," ","var"," ","rowid"," ","="," ","\"\"",";","\n","       "," ","if"," ","(","\"postgresql\""," \n ","=="," ","dbType",")"," ","{","\n","           "," rowid"," \n ","="," ","\"ctid\"",";","\n","       "," ","}"," ","else"," ","if"," ","(","\"oracle\""," \n ","=="," ","dbType",")"," ","{","\n","           "," rowid"," \n ","="," ","\"rowid\"",";","\n","       "," ","}","\n","       ","\n","       "," ","var"," ","sql"," ","="," ","\"select \""," \n ","+"," ","rowid"," ","+"," ","\" from \""," \n ","+"," ","tableName"," ","+"," ","\" where TIME_START < \n current_timestamp - interval '\"",";","\n","       ","\n","       "," ","if"," ","(","params",")"," ","{","\n","           "," ","if"," ","(","params","[","\"HOLD_HOURS\"","]"," ","!="," ","undefined",")"," ","{","\n","               "," sql"," \n ","+="," ","params","[","\"HOLD_HOURS\"","]"," ","+"," ","\"' hour\"",";","\n","           "," ","}","\n","          "," "," ","if"," \n ","(","params","[","\"AL_CLASS\"","]"," ","!="," ","undefined",")"," ","{","\n","               "," sql"," \n ","+="," ","\" and AL_CLASS in (\""," \n ","+"," ","params","[","\"AL_CLASS\"","]"," ","+"," ","\")\"",";","\n","           "," ","}","\n","       "," ","}"," ","else"," ","{","\n","           "," ","var"," ","msg"," ","="," ","\"[TableDel_AL_ARCHIVE] \n no parameters provided; please provide at least parameter HOLD_HOURS\"",";","\n","           "," logger",".","error","(","msg",");","\n","           "," ","throw","(","msg",");","\n","       "," ","}","\n","       ","\n","       "," ","// only delete 100k records \n at once","\n","       "," sql"," \n ","+="," ","getLimit","(","dbType",","," ","100000",");","\n","  "," ","     ","sql"," \n ","="," ","\"delete from \""," \n ","+"," ","tableName"," ","+"," ","\" where \""," \n ","+"," ","rowid"," ","+"," ","\" in (\""," ","+"," ","sql"," ","+"," ","\")\"","\n","       "," logger",".","debug","(","'[TableDel_AL_ARCHIVE] executing \n SQL: '"," ","+"," ","sql",");","\n","       ","\n","       "," qry"," \n ","="," ","new"," ","DbQuery","(","con",","," ","sql",","," ","null",");","\n","       "," affectedRows"," \n ","="," ","qry",".","execute","();","\n","       "," logger",".","info","(","\"[TableDel_AL_ARCHIVE] \n Successfully deleted \""," ","+"," \n ","affectedRows"," ","+"," ","\" rows\"",");","\n","   "," ","}"," ","finally"," ","{","\n","       "," ","if"," ","(","qry"," ","!="," ","null",")"," ","qry",".","close","();","\n","       "," ","if"," ","(","con"," ","!="," ","null",")"," ","con",".","close","();","\n","   "," ","}","\n","   ","\n","   "," ","return"," ","affectedRows",";","\n","}","\n"," ","\n"," ","\n","function"," \n ","/*String*/"," ","getLimit","(","/*String*/"," ","dbType",","," ","/*int*/"," ","rows",")"," ","{","\n","   "," ","if"," ","(","\"postgresql\""," \n ","=="," ","dbType",")"," ","{","\n","       "," ","return"," ","\" limit \""," \n ","+"," ","rows",";","\n","   "," ","}"," ","else"," ","if"," ","(","\"oracle\""," \n ","=="," ","dbType",")"," ","{","\n","       "," ","return"," ","\" fetch first \""," \n ","+"," ","rows"," ","+"," ","\" rows only\"",";","\n","   "," ","}"," ","else"," ","{","\n","       "," ","// no limitation","\n","       "," ","return"," ","\"\"",";","\n","   "," ","}","\n","}","\n"," ","\n\n\n"]],"3":[["Beschreibung"],["Beispiel Insert-Statement"],["Beispiel JavaScript"]],"4":[["Lösch-Job Beispiel"]],"id":"271"})